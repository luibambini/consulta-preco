<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leitor de Código de Barras</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    /* Estilo geral */
    body, html {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      width: 100%;
      height: 100%;
      overflow: hidden; /* Impede rolagem */
      background-color: #000;
    }

    #camera-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: black;
    }

    #reader {
      width: 100%;
      height: 100%;
      object-fit: cover; /* Ajusta o vídeo para preencher a tela */
      position: absolute;
    }

    /* Moldura de leitura */
    .scan-area {
      position: absolute;
      width: 300px; /* Ajusta para o tamanho desejado */
      height: 100px; /* Altura da área de leitura */
      border: 4px dashed #4CAF50;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    /* Botão para encerrar a leitura */
    #close-button {
      position: absolute;
      top: 20px;
      left: 20px;
      background-color: red;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      z-index: 20;
    }

    #result {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 18px;
      text-align: center;
      z-index: 15;
    }
  </style>
</head>
<body>
  <!-- Contêiner da câmera -->
  <div id="camera-container">
    <div id="reader"></div>
    <div class="scan-area"></div> <!-- Moldura de leitura -->
    <button id="close-button" onclick="stopScanner()">Fechar</button>
    <p id="result">Aponte a câmera para o código de barras</p>
  </div>

  <script>
    let html5QrCode;

    // Iniciar o scanner
    function startScanner() {
      const readerElement = document.getElementById("reader");
      const resultElement = document.getElementById("result");

      // Cria a instância do leitor
      html5QrCode = new Html5Qrcode("reader");

      // Configurações do leitor
      html5QrCode
        .start(
          { facingMode: "environment" }, // Usa a câmera traseira
          {
            fps: 15, // Reduz FPS para maior precisão
            qrbox: { width: 300, height: 100 }, // Área visível para leitura
            disableFlip: true, // Desativa espelhamento horizontal
          },
          (decodedText) => {
            // Código detectado
            resultElement.textContent = `Código detectado: ${decodedText}`;
            stopScanner(); // Para o scanner após a leitura
          },
          (error) => {
            // Ignora erros para não sobrecarregar o console
          }
        )
        .catch((err) => {
          console.error("Erro ao iniciar o leitor:", err);
        });
    }

    // Parar o scanner
    function stopScanner() {
      const resultElement = document.getElementById("result");

      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          resultElement.textContent = "Leitura encerrada.";
          html5QrCode = null; // Limpa a instância do leitor
        });
      }
    }

    // Inicia o scanner ao carregar a página
    window.onload = () => {
      startScanner();
    };
  </script>
</body>
</html>
